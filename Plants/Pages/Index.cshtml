@page
@using System.Reflection;
@using Plants.Models.Dto;
@using System.Drawing;
@model IndexModel
@{
	ViewData["Title"] = "Home page";
}

<div class="container mt-5">
	<div class="card">
		<div class="card-header" id="filterHeader">
			<div class="row">
				<div class="col col-auto">
					<button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#filterContent">
						Filter
					</button>
				</div>
				<div class="col col-auto">
					<form method="get">
						<input type="hidden" name="reset" value="true" />
						<button class="btn btn-link" type="submit">Reset</button>
					</form>
				</div>
			</div>
		</div>

		<div id="filterContent" class="@(Model.FilterIsApplied ? "show" : "collapse")">
			<div class="card-body">
				<form asp-route-pageid="1" method="post">
					<div class="row mb-2" id="Name">
						<div class="col-2 d-flex align-items-center">
							Name
						</div>
						<div class="col-2">
							<input type="text" class="form-control" asp-for=Filter.Name value=@Model.Filter.Name placeholder="<enter a name>">
						</div>
					</div>
					<div class="row" id="FlowerColorCode">
						<div class="col-2 d-flex align-items-center">
							Flower Color
						</div>
						<div class="col-4">
							<div class="card p-2 bg-light">
								<div class="color-palette">
									<input type="radio" id="default" asp-for=Filter.FlowerColorCode value="-1">
									<label class="bg-light" title="Not selected" for="default">X</label>

									@if (Model.Palette != null)
									{
										foreach (var clr in Model.Palette.OrderBy(clr => clr.ColorCode))
										{
											<input type="radio" id="@clr.ColorCode" asp-for=Filter.FlowerColorCode value=@clr.ColorCode>
											<label for="@clr.ColorCode" title="@clr.Name" style="background-color: @($"#{clr.ColorCode:X6}");"></label>
										}
									}
								</div>
							</div>
						</div>
					</div>

					<div class="row" id="Poisonous">
						<div class="col-2">
							Poisonous
						</div>
						<div class="col-10">
							<label>
								<input type="radio" asp-for="Filter.Poisonous" value="true" checked="@(Model.Filter.Poisonous == true)">
								Yes
							</label>
							<label>
								<input type="radio" asp-for="Filter.Poisonous" value="false" checked="@(Model.Filter.Poisonous == false)">
								No
							</label>
							<label>
								<input type="radio" asp-for="Filter.Poisonous" value="" checked="@(Model.Filter.Poisonous == null)">
								Any
							</label>
						</div>
					</div>
					<div class="row" id="ForHerbalTea">
						<div class="col-2">
							For herbal tea
						</div>
						<div class="col-10">
							<label>
								<input type="radio" asp-for="Filter.ForHerbalTea" value="true" checked="@(Model.Filter.ForHerbalTea == true)">
								Yes
							</label>
							<label>
								<input type="radio" asp-for="Filter.ForHerbalTea" value="false" checked="@(Model.Filter.ForHerbalTea == false)">
								No
							</label>
							<label>
								<input type="radio" asp-for="Filter.ForHerbalTea" value="" checked="@(Model.Filter.ForHerbalTea == null)">
								Any
							</label>
						</div>
					</div>
					<div class="row" id="PickingProhibited">
						<div class="col-2">
							Picking is prohibited
						</div>
						<div class="col-10">
							<label>
								<input type="radio" asp-for="Filter.PickingProhibited" value="true" checked="@(Model.Filter.PickingProhibited == true)">
								Yes
							</label>
							<label>
								<input type="radio" asp-for="Filter.PickingProhibited" value="false" checked="@(Model.Filter.PickingProhibited == false)">
								No
							</label>
							<label>
								<input type="radio" asp-for="Filter.PickingProhibited" value="" checked="@(Model.Filter.PickingProhibited == null)">
								Any
							</label>
						</div>
					</div>
					<div class="row" id="Submit">
						<div class="col-1">
							<button type="submit" class="btn btn-primary mt-3">Apply</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<div class="container">
	<div class="row">
		@if (Model.TotalPages == 0)
		{
			<p>No plants found</p>
		}
		else if (Model.RequestedPlants != null)
		{
			foreach (var plant in Model.RequestedPlants)
			{
				if (plant?.Names != null)
				{
					<div class="col-4 ">
						<div class="p-0 my-3 border">
							<div class="card">
								<img src="@plant.ImageLinks?.FirstOrDefault()?.ImageUrl" class="card-img-top fixed-card-img-top">
								<div class="card-body">
									@foreach (var pn in plant!.Names.OrderBy(pn => pn.Language))
									{
										<h3 class="card-title text-success">@pn.Name</h3>
									}
									<p class="card-text">
										Poisonous:	@Model.NullBoolToString(plant.Poisonous)<br>
										For herbal tea: @Model.NullBoolToString(plant.ForHerbalTea)<br>
										Picking is prohibited: @Model.NullBoolToString(plant.PickingProhibited)
									</p>
								</div>
							</div>
						</div>
					</div>					
				}
			}
		}
	</div>
	<div class="row" id="TotalCount">
		<div class="col-4 ">
			Total plants: @Model.TotalCount
		</div>
	</div>

	<div class="row">
		<nav aria-label="Page navigation">
			<ul class="pagination">
				<li class="page-item @(Model.HasPreviousPage ? "enabled" : "disabled")">
					<a class="page-link" asp-route-pageid="@(Model.PageId - 1)">Previous</a>
				</li>

				@for (int i = 1; i <= Model.TotalPages; i++)
				{
					<li class="page-item @(Model.PageId == i ? "active" : "")">
						<a class="page-link" asp-route-pageid="@i">@i</a>
					</li>
				}

				<li class="page-item @(Model.HasNextPage ? "enabled" : "disabled")">
					<a class="page-link" asp-route-pageid="@(Model.PageId + 1)">Next</a>
				</li>
			</ul>
		</nav>
	</div>
</div>